scaneonefs <- function(crossobject, phenocol = 5, ) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = 1000), probs = .95))
lods <- mapresult
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods)
}
}
return(lods)
}
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- mapresult
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 1000)
?lm
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- mapresult
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus, na.action = na.omit))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods)
}
}
return(lods)
}
?lm
test <- scaneonefs(N2xCB4856.cross, 5, 1000)
test <- scaneonefs(N2xCB4856.cross, 5, 100)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- mapresult
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus, na.action = na.exclude))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- mapresult
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus, na.action = na.exclude))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
residuals(lm(pheno~genoatlocus, na.action = na.exclude))
max(mapresult)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- mapresult
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus, na.action = na.exclude))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus, na.action = na.exclude))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
test <- scaneonefs(N2xCB4856.cross, 5, 100)
max(mapresult)$lod
View(lods)
version
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.factor(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus, na.action = na.exclude))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
View(lods)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.factor(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus, na.action = na.exclude))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.factor(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
pheno <- crossobject$pheno[,phenocol]
crossobject$pheno[,phenocol] <- residuals(lm(pheno~genoatlocus, na.action = na.exclude))
mapresult <- scanone(crossobject, phenocol)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
View(lods)
crossobject$pheno[,phenocol]
test <- scaneonefs(N2xCB4856.cross, 5, 100)
View(lods)
View(mapresult)
View(lods)
View(mapresult)
pheno == residuals(lm(pheno~genoatlocus, na.action = na.exclude))
crossobject$pheno[,phenocol]
max(mapresult)
max(mapresult)
View(mapresult)
View(lods)
View(LODS.01s)
test <- scaneonefs(N2xCB4856.cross, 5, 100)
View(crossobject$pheno)
mapresult <- scanone(crossobject, phenocol)
View(mapresult)
View(lods)
max(mapresult)
max(lods)
View(lods)
max(lods$lod)
View(genoatlocus)
genoatlocus
sum(genoatlocus == 1)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.factor(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
mapresult <- scanone(crossobject, phenocol, addcovar = genoatlocus)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.factor(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
mapresult <- scanone(crossobject, phenocol, addcovar = genoatlocus)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
max(mapresult)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
mapresult <- scanone(crossobject, phenocol, addcovar = genoatlocus)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
max(mapresult)
View(lods)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
mapresult <- scanone(crossobject, phenocol, addcovar = genoatlocus)
print(max(mapresult))
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
?rnorm()
rnorm(100)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
covars = matrix()
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
covars <- cbind(covars, genoatlocus)
mapresult <- scanone(crossobject, phenocol, addcovar = covars)
print(max(mapresult))
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
covars = matrix()
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
covars <- cbind(covars, genoatlocus)
mapresult <- scanone(crossobject, phenocol, addcovar = covars)
print(max(mapresult))
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
test <- scaneonefs(N2xCB4856.cross, 5, 100)
covars
matrix
matrix()
?"matrix"
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
covars = matrix(nrow = length(crossobject$pheno[phenocol]), ncol = 0)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
covars <- cbind(covars, genoatlocus)
mapresult <- scanone(crossobject, phenocol, addcovar = covars)
print(max(mapresult))
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
covars
length(crossobject$pheno[phenocol])
length(crossobject$pheno[,phenocol])
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
browser()
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
covars = matrix(nrow = length(crossobject$pheno[, phenocol]), ncol = 0)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
covars <- cbind(covars, genoatlocus)
mapresult <- scanone(crossobject, phenocol, addcovar = covars)
print(max(mapresult))
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
threshold
test <- scaneonefs(N2xCB4856.cross, 5, 100)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
covars = matrix(nrow = length(crossobject$pheno[, phenocol]), ncol = 0)
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
covars <- cbind(covars, genoatlocus)
mapresult <- scanone(crossobject, phenocol, addcovar = covars)
print(max(mapresult))
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
scaneonefs <- function(crossobject, phenocol = 5, nperm) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
covars = matrix(nrow = length(crossobject$pheno[, phenocol]), ncol = 0)
i = 1
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
covars <- cbind(covars, genoatlocus)
mapresult <- scanone(crossobject, phenocol, addcovar = covars)
print(max(mapresult))
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
colnames(lods)[ncol(lods)] <- paste0("lod", i)
i = i+1
}
}
return(lods)
}
scaneonefs <- function(crossobject, phenocol = 5, nperm = 1000) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
covars = matrix(nrow = length(crossobject$pheno[, phenocol]), ncol = 0)
i = 1
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
covars <- cbind(covars, genoatlocus)
mapresult <- scanone(crossobject, phenocol, addcovar = covars)
print(max(mapresult))
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
colnames(lods)[ncol(lods)] <- paste0("lod", i)
i = i+1
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
View(test)
scaneonefs <- function(crossobject, phenocol = 5, nperm = 1000) {
mapresult <- scanone(crossobject, phenocol)
threshold <- as.numeric(quantile(scanone(crossobject, n.perm = nperm), probs = .95))
lods <- data.frame(mapresult)
covars = matrix(nrow = length(crossobject$pheno[, phenocol]), ncol = 0)
i = 1
while (max(mapresult)$lod > threshold) {
genoatlocus <- as.numeric(
pull.geno(crossobject,
max(mapresult)$chr)[,rownames(max(mapresult))[1]])
covars <- cbind(covars, genoatlocus)
mapresult <- scanone(crossobject, phenocol, addcovar = covars)
if (max(mapresult)$lod > threshold) {
lods <- cbind(lods, mapresult$lod)
colnames(lods)[ncol(lods)] <- paste0("lod", i)
i = i+1
}
}
return(lods)
}
test <- scaneonefs(N2xCB4856.cross, 5, 100)
View(test)
load("~/HTA_Linkage/markers244.Rda")
View(markers)
View(test)
View(markers)
View(test)
devtools::install_github("AndersenLab/easysorter")
library(dplyr)
library(easysorter)
rilsdirs <- c("~/Dropbox/HTA/Results/20140428_RIAILs1a/", "~/Dropbox/HTA/Results/20140429_RIAILs1b/", "~/Dropbox/HTA/Results/20140505_RIAILs1c/", "~/Dropbox/HTA/Results/20140506_RIAILs1d/", "~/Dropbox/HTA/Results/20140512_RIAILs1e/","~/Dropbox/HTA/Results/20140513_RIAILs1f/", "~/Dropbox/HTA/Results/20140519_RIAILs1g/", "~/Dropbox/HTA/Results/20140520_RIAILs1h/", "~/Dropbox/HTA/Results/20140526_RIAILs1i/", "~/Dropbox/HTA/Results/20140527_RIAILs1j/", "~/Dropbox/HTA/Results/20140603_RIAILs1k/", "~/Dropbox/HTA/Results/20140623_RIAILs1l/", "~/Dropbox/HTA/Results/20140624_RIAILs1m/")
rilsdata <- lapply(rilsdirs, read_data)
rilswithoutcontam <- lapply(rilsdata, function(x) {
x[[1]] <- filter(x[[1]], !contamination)
return(x)
})
sumrils <- lapply(rilswithoutcontam, function(x) sumplate(x, quantiles = TRUE))
onerils <- rbind_all(sumrils) %>% select(-contains("green"))
filteredrils <- onerils %>%
filter(assay != "a", assay != "c", assay != "g") %>%
filter(!(assay == "b" & condition == "methotrexate-125"),
!(assay == "b" & condition == "albendazole"),
!(assay == "d" & condition == "methotrexate-125"),
!(assay == "d" & condition == "albendazole"))
bioprunedrils <- filteredrils %>%
filter(n > 25, n < 1000, norm.n < 350)
assayregressedrils <- regress(bioprunedrils, assay = TRUE)
prunedrils <- bamf_prune(assayregressedrils, drop = TRUE) %>% select(-bamfoutlier1,
-bamfoutlier2,
-bamfoutlier3)
filteredrils <- onerils %>%
filter(assay != "a", assay != "c", assay != "g") %>%
filter(!(assay == "b" & condition == "methotrexate-125"),
!(assay == "b" & condition == "albendazole"),
!(assay == "d" & condition == "methotrexate-125"),
!(assay == "d" & condition == "albendazole"))
bioprunedrils <- filteredrils %>%
filter(n > 25, n < 1000, norm.n < 350)
assayregressedrils <- regress(bioprunedrils, assay = TRUE)
debug(regress)
assayregressedrils <- regress(bioprunedrils, assay = TRUE)
assayregressedrils <- regress(bioprunedrils, assay = TRUE)
fusedmoltendata <- na.omit(fusedmoltendata)
library(dplyr)
library(easysorter)
rilsdirs <- c("~/Dropbox/HTA/Results/20140630_RIAILs2a/", "~/Dropbox/HTA/Results/20140701_RIAILs2b/", "~/Dropbox/HTA/Results/20140707_RIAILs2c/", "~/Dropbox/HTA/Results/20140708_RIAILs2d/", "~/Dropbox/HTA/Results/20140714_RIAILs2e/","~/Dropbox/HTA/Results/20140715_RIAILs2f/", "~/Dropbox/HTA/Results/20140721_RIAILs2g/", "~/Dropbox/HTA/Results/20140722_RIAILs2h/", "~/Dropbox/HTA/Results/20140728_RIAILs2i/", "~/Dropbox/HTA/Results/20140729_RIAILs2j/")
rilsdata <- lapply(rilsdirs, read_data)
